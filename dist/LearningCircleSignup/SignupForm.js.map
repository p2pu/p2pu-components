{"version":3,"sources":["../../src/LearningCircleSignup/SignupForm.jsx"],"names":["React","useState","t","jt","Promise","InputWithLabel","CheckboxWithLabel","MobileInput","SignupSuccess","SignupForm","props","initialState","submitting","signupSuccess","name","email","goals","support","custom_question","mobile","communications_opt_in","consent","errors","state","setState","handleSubmit","e","preventDefault","data","learning_circle","learningCircle","id","signup_questions","fetch","signUpUrl","method","headers","body","JSON","stringify","then","resp","json","status","console","log","error","getError","fieldName","onDataChange","callback","gdprUrl","gdprLink","consentLabel","signup_question","onCancel","position","top","left","width","height","background"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport { t, jt } from 'ttag';\nimport Promise from 'promise-polyfill'\nimport 'whatwg-fetch'\nimport InputWithLabel from '../InputFields/InputWithLabel';\nimport CheckboxWithLabel from '../InputFields/CheckboxWithLabel';\nimport MobileInput from '../InputFields/MobileInput';\nimport SignupSuccess from './SignupSuccess';\n\nconst SignupForm = props => {\n  const initialState = {\n    submitting: false,\n    signupSuccess: false,\n    name: '',\n    email: '',\n    goals: '',\n    support: '',\n    custom_question: '',\n    mobile: '',\n    communications_opt_in: false,\n    consent: false,\n    errors: {},\n  };\n\n  const [ state, setState ] = useState(initialState)\n\n  const handleSubmit = e => {\n    e.preventDefault();\n    // Send data to signup API\n    let {\n      name,\n      email,\n      mobile,\n      goals,\n      support,\n      custom_question,\n      consent,\n      communications_opt_in,\n    } = state;\n\n    let data = {\n      learning_circle: props.learningCircle.id,\n      name,\n      email,\n      mobile,\n      consent,\n      communications_opt_in,\n      signup_questions: {\n        goals, support, custom_question,\n      },\n    };\n\n    setState({...state, submitting: true, errors: {} });\n    fetch(props.signUpUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(data)\n    }).then(resp => resp.json()).then( json => {\n      // check respose code\n      if (json.status == 'created'){\n        console.log('Signed up!');\n        setState({...state, submitting: false, signupSuccess: true });\n        // TODO props.onSignupSuccess;\n      } else {\n        console.log('Error, signup failed: ' + JSON.stringify(json));\n        setState({...state, submitting: false, errors: json.errors });\n      }\n    }).catch(error => {\n      console.log('Error: something went wrong with the request');\n      // check error\n      setState({...state, submitting: false });\n    });\n  }\n\n  const getError = (fieldName) => {\n    if (state.errors && state.errors[fieldName]) {\n      return state.errors[fieldName];\n    }\n    return null;\n  }\n\n  const onDataChange = (data, callback=null) => {\n    setState({...state, ...data}, callback);\n  }\n\n  const {\n    name,\n    email,\n    mobile,\n    goals,\n    support,\n    custom_question,\n    consent,\n    communications_opt_in\n  } = state;\n  const { gdprUrl='/gdpr' } = props;\n  let gdprLink = <a href={gdprUrl} key=\"gdprLink\">{t`More information.`}</a>;\n  let consentLabel = t`I consent that P2PU may process my personal data provided here for the purpose of participating in this learning circle.`;\n  return (\n    <form className=\"signup-modal\" onSubmit={handleSubmit} >\n      { state.signupSuccess && <SignupSuccess learningCircle={props.learningCircle} /> }\n      { !state.signupSuccess &&\n          <div>\n            <InputWithLabel\n              label={t`Name`}\n              value={name}\n              handleChange={onDataChange}\n              name={'name'}\n              id={'id_name'}\n              errorMessage={getError('name')}\n              required={true}\n            />\n            <InputWithLabel\n              label={t`Email address`}\n              value={email}\n              handleChange={onDataChange}\n              type=\"email\"\n              name='email'\n              id='id_email'\n              errorMessage={getError('email')}\n              required={true}\n            />\n            <MobileInput\n              label={t`If you'd like to receive weekly text messages reminding you of upcoming learning circle meetings, put your phone number here.`}\n              value={mobile}\n              handleChange={onDataChange}\n              name={'mobile'}\n              id={'id_mobile'}\n              errorMessage={getError('mobile')}\n              required={false}\n            />\n            <p>{t`Your number won't be shared with other participants.`}</p>\n            <InputWithLabel\n              label={t`Why do you want to learn this topic?`}\n              name='goals'\n              value={goals}\n              handleChange={onDataChange}\n              id='id_email'\n              errorMessage={state.errors && state.errors.signup_questions && state.errors.signup_questions[0].goals}\n              required={true}\n            />\n            <InputWithLabel\n              label={t`A successful study group requires the support of all of its members. How will you help your peers achieve their goals?`}\n              value={support}\n              handleChange={onDataChange}\n              name={'support'}\n              id={'id_support'}\n              errorMessage={state.errors && state.errors.signup_questions && state.errors.signup_questions[0].support}\n              required={true}\n            />\n            { props.learningCircle.signup_question &&\n              <InputWithLabel\n                label={props.learningCircle.signup_question}\n                value={custom_question}\n                handleChange={onDataChange}\n                name={'custom_question'}\n                id={'id_custom_questions'}\n                errorMessage={state.errors && state.errors.signup_questions && state.errors.signup_questions[0].custom_question}\n                required={true}\n              />\n            }\n            <CheckboxWithLabel\n              name=\"consent\"\n              label={consentLabel}\n              helpText={gdprLink}\n              value={consent}\n              handleChange={onDataChange}\n              errorMessage={getError('consent')}\n              required={true}\n            />\n            <CheckboxWithLabel\n              classes=\"d-flex\"\n              label={t`I would like to receive emails about other future learning opportunities from P2PU.`}\n              value={communications_opt_in}\n              handleChange={onDataChange}\n              name={'communications_opt_in'}\n              id={'id_communications_opt_in'}\n              errorMessage={''}\n              required={false}\n            />\n            <button className=\"btn p2pu-btn blue\" type=\"submit\">{t`Sign up`}</button>\n          </div>\n      }\n      <button className=\"p2pu-btn blue secondary\" onClick={props.onCancel}>{t`Back to search`}</button>\n      { state.submitting &&\n          <div className=\"signup-form-submitting\" style={{position: 'absolute', top: '0px', left: '0px', width: '100%', height: '100%', background: 'rgba(255,255,255, 0.9)', ['text-align']: 'center'}}>\n            <div className=\"spinner-border\" role=\"status\">\n              <span className=\"sr-only\">{t`Submitting...`}</span>\n            </div>\n          </div>\n      }\n    </form>\n  );\n};\n\nexport default SignupForm\n"],"file":"SignupForm.js"}