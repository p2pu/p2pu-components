{"version":3,"file":"SignupForm.js","names":["React","useState","t","jt","Promise","InputWithLabel","CheckboxWithLabel","MobileInput","SignupSuccess","SignupForm","props","initialState","submitting","signupSuccess","name","email","goals","support","custom_question","mobile","communications_opt_in","consent","errors","state","setState","handleSubmit","e","preventDefault","data","learning_circle","learningCircle","id","signup_questions","fetch","signUpUrl","method","headers","body","JSON","stringify","then","resp","json","status","console","log","error","getError","fieldName","onDataChange","callback","gdprUrl","gdprLink","consentLabel","signup_question","onCancel","position","top","left","width","height","background"],"sources":["../../src/LearningCircleSignup/SignupForm.jsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { t, jt } from 'ttag';\nimport Promise from 'promise-polyfill'\nimport 'whatwg-fetch'\nimport InputWithLabel from '../InputFields/InputWithLabel';\nimport CheckboxWithLabel from '../InputFields/CheckboxWithLabel';\nimport MobileInput from '../InputFields/MobileInput';\nimport SignupSuccess from './SignupSuccess';\n\nconst SignupForm = props => {\n  const initialState = {\n    submitting: false,\n    signupSuccess: false,\n    name: '',\n    email: '',\n    goals: '',\n    support: '',\n    custom_question: '',\n    mobile: '',\n    communications_opt_in: false,\n    consent: false,\n    errors: {},\n  };\n\n  const [ state, setState ] = useState(initialState)\n\n  const handleSubmit = e => {\n    e.preventDefault();\n    // Send data to signup API\n    let {\n      name,\n      email,\n      mobile,\n      goals,\n      support,\n      custom_question,\n      consent,\n      communications_opt_in,\n    } = state;\n\n    let data = {\n      learning_circle: props.learningCircle.id,\n      name,\n      email,\n      mobile,\n      consent,\n      communications_opt_in,\n      signup_questions: {\n        goals, support, custom_question,\n      },\n    };\n\n    setState({...state, submitting: true, errors: {} });\n    fetch(props.signUpUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(data)\n    }).then(resp => resp.json()).then( json => {\n      // check respose code\n      if (json.status == 'created'){\n        console.log('Signed up!');\n        setState({...state, submitting: false, signupSuccess: true });\n        // TODO props.onSignupSuccess;\n      } else {\n        console.log('Error, signup failed: ' + JSON.stringify(json));\n        setState({...state, submitting: false, errors: json.errors });\n      }\n    }).catch(error => {\n      console.log('Error: something went wrong with the request');\n      // check error\n      setState({...state, submitting: false });\n    });\n  }\n\n  const getError = (fieldName) => {\n    if (state.errors && state.errors[fieldName]) {\n      return state.errors[fieldName];\n    }\n    return null;\n  }\n\n  const onDataChange = (data, callback=null) => {\n    setState({...state, ...data}, callback);\n  }\n\n  const {\n    name,\n    email,\n    mobile,\n    goals,\n    support,\n    custom_question,\n    consent,\n    communications_opt_in\n  } = state;\n  const { gdprUrl='/gdpr' } = props;\n  let gdprLink = <a href={gdprUrl} key=\"gdprLink\">{t`More information.`}</a>;\n  let consentLabel = t`I consent that P2PU may process my personal data provided here for the purpose of participating in this learning circle.`;\n  return (\n    <form className=\"signup-modal\" onSubmit={handleSubmit} >\n      { state.signupSuccess && <SignupSuccess learningCircle={props.learningCircle} /> }\n      { !state.signupSuccess &&\n          <div>\n            <InputWithLabel\n              label={t`Name`}\n              value={name}\n              handleChange={onDataChange}\n              name={'name'}\n              id={'id_name'}\n              errorMessage={getError('name')}\n              required={true}\n            />\n            <InputWithLabel\n              label={t`Email address`}\n              value={email}\n              handleChange={onDataChange}\n              type=\"email\"\n              name='email'\n              id='id_email'\n              errorMessage={getError('email')}\n              required={true}\n            />\n            <MobileInput\n              label={t`If you'd like to receive weekly text messages reminding you of upcoming learning circle meetings, put your phone number here.`}\n              value={mobile}\n              handleChange={onDataChange}\n              name={'mobile'}\n              id={'id_mobile'}\n              errorMessage={getError('mobile')}\n              required={false}\n            />\n            <p>{t`Your number won't be shared with other participants.`}</p>\n            <InputWithLabel\n              label={t`Why do you want to learn this topic?`}\n              name='goals'\n              value={goals}\n              handleChange={onDataChange}\n              id='id_email'\n              errorMessage={state.errors && state.errors.signup_questions && state.errors.signup_questions[0].goals}\n              required={true}\n            />\n            <InputWithLabel\n              label={t`A successful study group requires the support of all of its members. How will you help your peers achieve their goals?`}\n              value={support}\n              handleChange={onDataChange}\n              name={'support'}\n              id={'id_support'}\n              errorMessage={state.errors && state.errors.signup_questions && state.errors.signup_questions[0].support}\n              required={true}\n            />\n            { props.learningCircle.signup_question &&\n              <InputWithLabel\n                label={props.learningCircle.signup_question}\n                value={custom_question}\n                handleChange={onDataChange}\n                name={'custom_question'}\n                id={'id_custom_questions'}\n                errorMessage={state.errors && state.errors.signup_questions && state.errors.signup_questions[0].custom_question}\n                required={true}\n              />\n            }\n            <CheckboxWithLabel\n              name=\"consent\"\n              label={consentLabel}\n              helpText={gdprLink}\n              value={consent}\n              handleChange={onDataChange}\n              errorMessage={getError('consent')}\n              required={true}\n            />\n            <CheckboxWithLabel\n              classes=\"d-flex\"\n              label={t`I would like to receive emails about other future learning opportunities from P2PU.`}\n              value={communications_opt_in}\n              handleChange={onDataChange}\n              name={'communications_opt_in'}\n              id={'id_communications_opt_in'}\n              errorMessage={''}\n              required={false}\n            />\n            <button className=\"btn p2pu-btn blue\" type=\"submit\">{t`Sign up`}</button>\n          </div>\n      }\n      <button className=\"p2pu-btn blue secondary\" onClick={props.onCancel}>{t`Back to search`}</button>\n      { state.submitting &&\n          <div className=\"signup-form-submitting\" style={{position: 'absolute', top: '0px', left: '0px', width: '100%', height: '100%', background: 'rgba(255,255,255, 0.9)', ['text-align']: 'center'}}>\n            <div className=\"spinner-border\" role=\"status\">\n              <span className=\"sr-only\">{t`Submitting...`}</span>\n            </div>\n          </div>\n      }\n    </form>\n  );\n};\n\nexport default SignupForm\n"],"mappings":"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"}