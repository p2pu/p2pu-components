{"version":3,"file":"SignupForm.js","names":["React","useState","t","jt","Promise","InputWithLabel","CheckboxWithLabel","MobileInput","SignupSuccess","SignupForm","props","initialState","submitting","signupSuccess","name","email","goals","support","custom_question","mobile","communications_opt_in","consent","errors","_useState","_useState2","_slicedToArray","state","setState","handleSubmit","e","preventDefault","data","learning_circle","learningCircle","id","signup_questions","_objectSpread","fetch","signUpUrl","method","headers","body","JSON","stringify","then","resp","json","status","console","log","error","getError","fieldName","onDataChange","callback","arguments","length","undefined","_props$gdprUrl","gdprUrl","gdprLink","createElement","href","key","_templateObject","_taggedTemplateLiteral","consentLabel","_templateObject2","className","onSubmit","label","_templateObject3","value","handleChange","errorMessage","required","_templateObject4","type","_templateObject5","_templateObject6","_templateObject7","_templateObject8","signup_question","helpText","classes","_templateObject9","_templateObject10","onClick","onCancel","_templateObject11","style","_defineProperty","position","top","left","width","height","background","role","_templateObject12"],"sources":["../../src/LearningCircleSignup/SignupForm.jsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { t, jt } from 'ttag';\nimport Promise from 'promise-polyfill'\nimport 'whatwg-fetch'\nimport InputWithLabel from '../InputFields/InputWithLabel';\nimport CheckboxWithLabel from '../InputFields/CheckboxWithLabel';\nimport MobileInput from '../InputFields/MobileInput';\nimport SignupSuccess from './SignupSuccess';\n\nconst SignupForm = props => {\n  const initialState = {\n    submitting: false,\n    signupSuccess: false,\n    name: '',\n    email: '',\n    goals: '',\n    support: '',\n    custom_question: '',\n    mobile: '',\n    communications_opt_in: false,\n    consent: false,\n    errors: {},\n  };\n\n  const [ state, setState ] = useState(initialState)\n\n  const handleSubmit = e => {\n    e.preventDefault();\n    // Send data to signup API\n    let {\n      name,\n      email,\n      mobile,\n      goals,\n      support,\n      custom_question,\n      consent,\n      communications_opt_in,\n    } = state;\n\n    let data = {\n      learning_circle: props.learningCircle.id,\n      name,\n      email,\n      mobile,\n      consent,\n      communications_opt_in,\n      signup_questions: {\n        goals, support, custom_question,\n      },\n    };\n\n    setState({...state, submitting: true, errors: {} });\n    fetch(props.signUpUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(data)\n    }).then(resp => resp.json()).then( json => {\n      // check respose code\n      if (json.status == 'created'){\n        console.log('Signed up!');\n        setState({...state, submitting: false, signupSuccess: true });\n        // TODO props.onSignupSuccess;\n      } else {\n        console.log('Error, signup failed: ' + JSON.stringify(json));\n        setState({...state, submitting: false, errors: json.errors });\n      }\n    }).catch(error => {\n      console.log('Error: something went wrong with the request');\n      // check error\n      setState({...state, submitting: false });\n    });\n  }\n\n  const getError = (fieldName) => {\n    if (state.errors && state.errors[fieldName]) {\n      return state.errors[fieldName];\n    }\n    return null;\n  }\n\n  const onDataChange = (data, callback=null) => {\n    setState({...state, ...data}, callback);\n  }\n\n  const {\n    name,\n    email,\n    mobile,\n    goals,\n    support,\n    custom_question,\n    consent,\n    communications_opt_in\n  } = state;\n  const { gdprUrl='/gdpr' } = props;\n  let gdprLink = <a href={gdprUrl} key=\"gdprLink\">{t`More information.`}</a>;\n  let consentLabel = t`I consent that P2PU may process my personal data provided here for the purpose of participating in this learning circle.`;\n  return (\n    <form className=\"signup-modal\" onSubmit={handleSubmit} >\n      { state.signupSuccess && <SignupSuccess learningCircle={props.learningCircle} /> }\n      { !state.signupSuccess &&\n          <div>\n            <InputWithLabel\n              label={t`Name`}\n              value={name}\n              handleChange={onDataChange}\n              name={'name'}\n              id={'id_name'}\n              errorMessage={getError('name')}\n              required={true}\n            />\n            <InputWithLabel\n              label={t`Email address`}\n              value={email}\n              handleChange={onDataChange}\n              type=\"email\"\n              name='email'\n              id='id_email'\n              errorMessage={getError('email')}\n              required={true}\n            />\n            <MobileInput\n              label={t`If you'd like to receive weekly text messages reminding you of upcoming learning circle meetings, put your phone number here.`}\n              value={mobile}\n              handleChange={onDataChange}\n              name={'mobile'}\n              id={'id_mobile'}\n              errorMessage={getError('mobile')}\n              required={false}\n            />\n            <p>{t`Your number won't be shared with other participants.`}</p>\n            <InputWithLabel\n              label={t`Why do you want to learn this topic?`}\n              name='goals'\n              value={goals}\n              handleChange={onDataChange}\n              id='id_email'\n              errorMessage={state.errors && state.errors.signup_questions && state.errors.signup_questions[0].goals}\n              required={true}\n            />\n            <InputWithLabel\n              label={t`A successful study group requires the support of all of its members. How will you help your peers achieve their goals?`}\n              value={support}\n              handleChange={onDataChange}\n              name={'support'}\n              id={'id_support'}\n              errorMessage={state.errors && state.errors.signup_questions && state.errors.signup_questions[0].support}\n              required={true}\n            />\n            { props.learningCircle.signup_question &&\n              <InputWithLabel\n                label={props.learningCircle.signup_question}\n                value={custom_question}\n                handleChange={onDataChange}\n                name={'custom_question'}\n                id={'id_custom_questions'}\n                errorMessage={state.errors && state.errors.signup_questions && state.errors.signup_questions[0].custom_question}\n                required={true}\n              />\n            }\n            <CheckboxWithLabel\n              name=\"consent\"\n              label={consentLabel}\n              helpText={gdprLink}\n              value={consent}\n              handleChange={onDataChange}\n              errorMessage={getError('consent')}\n              required={true}\n            />\n            <CheckboxWithLabel\n              classes=\"d-flex\"\n              label={t`I would like to receive emails about other future learning opportunities from P2PU.`}\n              value={communications_opt_in}\n              handleChange={onDataChange}\n              name={'communications_opt_in'}\n              id={'id_communications_opt_in'}\n              errorMessage={''}\n              required={false}\n            />\n            <button className=\"btn p2pu-btn blue\" type=\"submit\">{t`Sign up`}</button>\n          </div>\n      }\n      <button className=\"p2pu-btn blue secondary\" onClick={props.onCancel}>{t`Back to search`}</button>\n      { state.submitting &&\n          <div className=\"signup-form-submitting\" style={{position: 'absolute', top: '0px', left: '0px', width: '100%', height: '100%', background: 'rgba(255,255,255, 0.9)', ['text-align']: 'center'}}>\n            <div className=\"spinner-border\" role=\"status\">\n              <span className=\"sr-only\">{t`Submitting...`}</span>\n            </div>\n          </div>\n      }\n    </form>\n  );\n};\n\nexport default SignupForm\n"],"mappings":"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"}