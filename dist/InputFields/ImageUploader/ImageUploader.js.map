{"version":3,"file":"ImageUploader.js","names":["React","Component","PropTypes","axios","slugify","InputWrapper","defaultStyles","preview","maxWidth","height","input","display","label","borderRadius","textTransform","fontSize","fontFamily","fontWeight","padding","transform","boxShadow","position","transition","margin","background","border","color","marginRight","ImageUploader","props","opts","url","data","config","method","responseType","then","res","errors","onError","onSuccess","err","console","log","onFail","e","imageUploadUrl","file","currentTarget","files","filename","name","FormData","append","setState","image","image_url","handleChange","headers","saveImage","state","value","required","disabled","errorMessage","helpText","labelStyles","inputStyles","imgStyles","acceptedMimetypes","buttonText","classes","id","rest","onChange","marginTop","propTypes","string","isRequired","func","object","defaultProps","imgUrl"],"sources":["../../../src/InputFields/ImageUploader/ImageUploader.js"],"sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport axios from 'axios';\nimport slugify from 'slugify';\nimport InputWrapper from '../InputWrapper'\n\nconst defaultStyles = {\n  preview: {\n    maxWidth: '250px',\n    height: 'auto',\n  },\n  input: {\n    display: \"none !important\"\n  },\n  label: {\n    borderRadius: \"2em\",\n    textTransform: \"uppercase\",\n    fontSize: \"0.8em\",\n    fontFamily: \"'Open Sans','Helvetica Neue',Helvetica,Arial,sans-serif\",\n    fontWeight: \"700\",\n    padding: \"10px 20px\",\n    transform: \"perspective(1px) translateZ(0)\",\n    boxShadow: \"0 0 1px transparent\",\n    position: \"relative\",\n    transition: \"color 0.3s linear\",\n    display: \"inline-block\",\n    margin: '2px',\n    background: \"#515665\",\n    border: \"2px solid #515665\",\n    color: \"#fff\",\n    marginRight: '6px',\n  }\n}\n\nexport default class ImageUploader extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      image: this.props.image,\n      file: null,\n    };\n  }\n\n  saveImage = opts => {\n    const url = opts.url;\n    const data = opts.data;\n    const config = opts.config;\n\n    axios({\n      url,\n      data,\n      config,\n      method: 'post',\n      responseType: 'json',\n    }).then(res => {\n      if (res.data.errors) {\n        return opts.onError(res.data)\n      }\n      opts.onSuccess(res.data)\n    }).catch(err => {\n      console.log(err)\n      opts.onFail(err)\n    })\n  }\n\n  onChange = (e) => {\n    const url = this.props.imageUploadUrl;\n    const file = e.currentTarget.files[0];\n    const filename = slugify(file.name)\n    const data = new FormData();\n    data.append('image', file, filename)\n\n    this.setState({ file })\n\n    const onSuccess = (data) => {\n      this.setState({ image: data.image_url });\n      this.props.handleChange({ [this.props.name]: data.image_url })\n    }\n\n    const onError = (data) => {\n      console.log(data.errors)\n      this.props.handleChange({ [this.props.name]: null })\n    }\n\n    const onFail = (err) => {\n      console.log(err)\n    }\n\n    const config = { headers: {'Content-Type': 'multipart/form-data' }}\n    const opts = { url, data, config, onSuccess, onError, onFail };\n\n    this.saveImage(opts);\n  }\n\n  render() {\n    const {\n      label,\n      name,\n      value,\n      required,\n      disabled,\n      errorMessage,\n      helpText,\n      labelStyles,\n      inputStyles,\n      imgStyles,\n      acceptedMimetypes,\n      buttonText,\n      classes,\n      handleChange,\n      id,\n      imageUploadUrl,\n      ...rest\n    } = this.props;\n    const { image, file } = this.state;\n    return(\n      <InputWrapper\n        label={label}\n        name={name}\n        id={id}\n        required={required}\n        disabled={disabled}\n        errorMessage={errorMessage}\n        helpText={helpText}\n        classes={classes}\n      >\n        <div>\n          <label htmlFor={\"image-uploader\"} className=\"btn p2pu-btn dark\" style={{...defaultStyles.label, ...labelStyles}}>\n            { buttonText }\n            <input\n              className='image-upload form-control hidden'\n              type='file'\n              name={\"image-uploader\"}\n              id={\"image-uploader\"}\n              required={required}\n              disabled={disabled}\n              onChange={this.onChange}\n              style={{...defaultStyles.input, ...inputStyles}}\n              hidden={true}\n              accept={acceptedMimetypes}\n              {...rest}\n            />\n          </label>\n          {\n            file ? <span>{file.name}</span> : <span>No file selected</span>\n          }\n          {\n            image &&\n            <div className='image-preview' style={{ marginTop: '10px' }}>\n              <img src={image} alt='Image preview' style={{...defaultStyles.preview, ...imgStyles}} />\n            </div>\n          }\n        </div>\n      </InputWrapper>\n    )\n  }\n}\n\nImageUploader.propTypes = {\n  imageUploadUrl: PropTypes.string.isRequired,\n  handleChange: PropTypes.func.isRequired,\n  name: PropTypes.string.isRequired,\n  classes: PropTypes.string,\n  label: PropTypes.string,\n  errorMessage: PropTypes.string,\n  helpText: PropTypes.string,\n  image: PropTypes.string,\n  imgStyles: PropTypes.object,\n  labelStyles: PropTypes.object,\n  inputStyles: PropTypes.object,\n  acceptedMimetypes: PropTypes.string,\n  buttonText: PropTypes.string,\n}\n\nImageUploader.defaultProps = {\n  handleChange: (imgUrl) => `Implement a function to save image ${imgUrl}`,\n  acceptedMimetypes: \"image/*\",\n  buttonText: 'Choose file',\n  imageUploadUrl: \"https://learningcircles.p2pu.org/api/upload_image/\"\n}\n"],"mappings":"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"}