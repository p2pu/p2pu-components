{"version":3,"file":"ImageUploader.js","names":["React","Component","PropTypes","axios","slugify","InputWrapper","defaults","xsrfCookieName","xsrfHeaderName","defaultStyles","preview","maxWidth","height","input","display","label","borderRadius","textTransform","fontSize","fontFamily","fontWeight","padding","transform","boxShadow","position","transition","margin","background","border","color","marginRight","ImageUploader","_Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","_defineProperty","_assertThisInitialized","opts","url","data","config","method","responseType","then","res","errors","onError","onSuccess","err","console","log","onFail","e","imageUploadUrl","file","currentTarget","files","filename","name","FormData","append","setState","image","image_url","handleChange","headers","saveImage","state","_createClass","key","value","render","_this$props","required","disabled","errorMessage","helpText","labelStyles","inputStyles","imgStyles","acceptedMimetypes","buttonText","classes","id","rest","_objectWithoutProperties","_excluded","_this$state","createElement","htmlFor","className","style","_objectSpread","_extends","type","onChange","hidden","accept","marginTop","src","alt","default","propTypes","string","isRequired","func","object","defaultProps","imgUrl","concat"],"sources":["../../../src/InputFields/ImageUploader/ImageUploader.js"],"sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport axios from 'axios';\nimport slugify from 'slugify';\nimport InputWrapper from '../InputWrapper'\n\naxios.defaults.xsrfCookieName = 'csrftoken'\naxios.defaults.xsrfHeaderName = 'X-CSRFToken'\n\nconst defaultStyles = {\n  preview: {\n    maxWidth: '250px',\n    height: 'auto',\n  },\n  input: {\n    display: \"none !important\"\n  },\n  label: {\n    borderRadius: \"2em\",\n    textTransform: \"uppercase\",\n    fontSize: \"0.8em\",\n    fontFamily: \"'Open Sans','Helvetica Neue',Helvetica,Arial,sans-serif\",\n    fontWeight: \"700\",\n    padding: \"10px 20px\",\n    transform: \"perspective(1px) translateZ(0)\",\n    boxShadow: \"0 0 1px transparent\",\n    position: \"relative\",\n    transition: \"color 0.3s linear\",\n    display: \"inline-block\",\n    margin: '2px',\n    background: \"#515665\",\n    border: \"2px solid #515665\",\n    color: \"#fff\",\n    marginRight: '6px',\n  }\n}\n\nexport default class ImageUploader extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      image: this.props.image,\n      file: null,\n    };\n  }\n\n  saveImage = opts => {\n    const url = opts.url;\n    const data = opts.data;\n    const config = opts.config;\n\n    axios({\n      url,\n      data,\n      config,\n      method: 'post',\n      responseType: 'json',\n    }).then(res => {\n      if (res.data.errors) {\n        return opts.onError(res.data)\n      }\n      opts.onSuccess(res.data)\n    }).catch(err => {\n      console.log(err)\n      opts.onFail(err)\n    })\n  }\n\n  onChange = (e) => {\n    const url = this.props.imageUploadUrl;\n    const file = e.currentTarget.files[0];\n    const filename = slugify(file.name)\n    const data = new FormData();\n    data.append('image', file, filename)\n\n    this.setState({ file })\n\n    const onSuccess = (data) => {\n      this.setState({ image: data.image_url });\n      this.props.handleChange({ [this.props.name]: data.image_url })\n    }\n\n    const onError = (data) => {\n      console.log(data.errors)\n      this.props.handleChange({ [this.props.name]: null })\n    }\n\n    const onFail = (err) => {\n      console.log(err)\n    }\n\n    const config = { headers: {'Content-Type': 'multipart/form-data' }}\n    const opts = { url, data, config, onSuccess, onError, onFail };\n\n    this.saveImage(opts);\n  }\n\n  render() {\n    const {\n      label,\n      name,\n      value,\n      required,\n      disabled,\n      errorMessage,\n      helpText,\n      labelStyles,\n      inputStyles,\n      imgStyles,\n      acceptedMimetypes,\n      buttonText,\n      classes,\n      handleChange,\n      id,\n      imageUploadUrl,\n      ...rest\n    } = this.props;\n    const { image, file } = this.state;\n    return(\n      <InputWrapper\n        label={label}\n        name={name}\n        id={id}\n        required={required}\n        disabled={disabled}\n        errorMessage={errorMessage}\n        helpText={helpText}\n        classes={classes}\n      >\n        <div>\n          <label htmlFor={\"image-uploader\"} className=\"btn p2pu-btn dark\" style={{...defaultStyles.label, ...labelStyles}}>\n            { buttonText }\n            <input\n              className='image-upload form-control hidden'\n              type='file'\n              name={\"image-uploader\"}\n              id={\"image-uploader\"}\n              required={required}\n              disabled={disabled}\n              onChange={this.onChange}\n              style={{...defaultStyles.input, ...inputStyles}}\n              hidden={true}\n              accept={acceptedMimetypes}\n              {...rest}\n            />\n          </label>\n          {\n            file ? <span>{file.name}</span> : <span>No file selected</span>\n          }\n          {\n            image &&\n            <div className='image-preview' style={{ marginTop: '10px' }}>\n              <img src={image} alt='Image preview' style={{...defaultStyles.preview, ...imgStyles}} />\n            </div>\n          }\n        </div>\n      </InputWrapper>\n    )\n  }\n}\n\nImageUploader.propTypes = {\n  imageUploadUrl: PropTypes.string.isRequired,\n  handleChange: PropTypes.func.isRequired,\n  name: PropTypes.string.isRequired,\n  classes: PropTypes.string,\n  label: PropTypes.string,\n  errorMessage: PropTypes.string,\n  helpText: PropTypes.string,\n  image: PropTypes.string,\n  imgStyles: PropTypes.object,\n  labelStyles: PropTypes.object,\n  inputStyles: PropTypes.object,\n  acceptedMimetypes: PropTypes.string,\n  buttonText: PropTypes.string,\n}\n\nImageUploader.defaultProps = {\n  handleChange: (imgUrl) => `Implement a function to save image ${imgUrl}`,\n  acceptedMimetypes: \"image/*\",\n  buttonText: 'Choose file',\n  imageUploadUrl: \"https://learningcircles.p2pu.org/api/upload_image/\"\n}\n"],"mappings":"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"}