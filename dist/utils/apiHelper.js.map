{"version":3,"sources":["../../src/utils/apiHelper.js"],"names":["API_ENDPOINTS","DEFAULT_ORIGIN","jsonp","axios","ApiHelper","resourceType","origin","urlOrigin","baseUrl","validParams","searchParams","params","encodedParams","map","key","value","Array","isArray","length","encodeURIComponent","queryString","filter","a","join","console","log","opts","url","generateUrl","err","data","callback","postUrl","config","method","responseType","then","res","errors","onError","onSuccess","onFail","id"],"mappings":"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","sourcesContent":["import { API_ENDPOINTS, DEFAULT_ORIGIN } from './constants';\nimport jsonp from 'jsonp';\nimport axios from 'axios';\n\nexport default class ApiHelper {\n  constructor(resourceType, origin=DEFAULT_ORIGIN) {\n    this.resourceType = resourceType;\n    this.urlOrigin = origin;\n    this.baseUrl = `${origin}${API_ENDPOINTS[resourceType].baseUrl}`;\n    this.validParams = API_ENDPOINTS[resourceType].searchParams;\n  }\n\n  generateUrl(params) {\n    const baseUrl = this.baseUrl;\n    const encodedParams = this.validParams.map((key) => {\n      const value = params[key];\n      if (!!value && !(Array.isArray(value) && value.length == 0)) { // don't encode falsy values or empty arrays\n        return `${key}=${encodeURIComponent(value)}`\n      }\n    })\n    const queryString = encodedParams.filter(a => a).join('&');\n\n    console.log('url', `${baseUrl}${queryString}`)\n    return `${baseUrl}${queryString}`\n  }\n\n  fetchResource(opts) {\n    const url = this.generateUrl(opts.params)\n\n    jsonp(url, null, (err, data) => {\n      if (err) {\n        console.log(err)\n      } else {\n        console.log(data)\n        opts.callback(data, opts)\n      }\n    })\n  }\n\n  createResource(opts) {\n    const url = `${this.urlOrigin}${API_ENDPOINTS[this.resourceType].postUrl}`;\n    const data = opts.data;\n    const config = opts.config;\n\n    axios({\n      url,\n      data,\n      config,\n      method: 'post',\n      responseType: 'json',\n    }).then(res => {\n      if (res.data.errors) {\n        return opts.onError(res.data)\n      }\n      opts.onSuccess(res.data)\n    }).catch(err => {\n      console.log(err)\n      opts.onFail(err)\n    })\n  }\n\n  updateResource(opts, id) {\n    const url = `${this.urlOrigin}${API_ENDPOINTS[this.resourceType].postUrl}${id}/`;\n    const data = opts.data;\n    const config = opts.config;\n\n    axios({\n      url,\n      data,\n      config,\n      method: 'post',\n      responseType: 'json',\n    }).then(res => {\n      if (res.data.errors) {\n        return opts.onError(res.data)\n      }\n      opts.onSuccess(res.data)\n    }).catch(err => {\n      console.log(err)\n      opts.onFail(err)\n    })\n  }\n}\n"],"file":"apiHelper.js"}