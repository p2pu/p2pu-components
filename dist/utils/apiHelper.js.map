{"version":3,"file":"apiHelper.js","names":["API_ENDPOINTS","DEFAULT_ORIGIN","jsonp","axios","ApiHelper","resourceType","origin","arguments","length","undefined","_classCallCheck","urlOrigin","baseUrl","concat","validParams","searchParams","_createClass","key","value","generateUrl","params","encodedParams","map","Array","isArray","encodeURIComponent","queryString","filter","a","join","console","log","fetchResource","opts","url","err","data","callback","createResource","postUrl","config","method","responseType","then","res","errors","onError","onSuccess","onFail","updateResource","id","default"],"sources":["../../src/utils/apiHelper.js"],"sourcesContent":["import { API_ENDPOINTS, DEFAULT_ORIGIN } from './constants';\nimport jsonp from 'jsonp';\nimport axios from 'axios';\n\nexport default class ApiHelper {\n  constructor(resourceType, origin=DEFAULT_ORIGIN) {\n    this.resourceType = resourceType;\n    this.urlOrigin = origin;\n    this.baseUrl = `${origin}${API_ENDPOINTS[resourceType].baseUrl}`;\n    this.validParams = API_ENDPOINTS[resourceType].searchParams;\n  }\n\n  generateUrl(params) {\n    const baseUrl = this.baseUrl;\n    const encodedParams = this.validParams.map((key) => {\n      const value = params[key];\n      if (!!value && !(Array.isArray(value) && value.length == 0)) { // don't encode falsy values or empty arrays\n        return `${key}=${encodeURIComponent(value)}`\n      }\n    })\n    const queryString = encodedParams.filter(a => a).join('&');\n\n    console.log('url', `${baseUrl}${queryString}`)\n    return `${baseUrl}${queryString}`\n  }\n\n  fetchResource(opts) {\n    const url = this.generateUrl(opts.params)\n\n    jsonp(url, null, (err, data) => {\n      if (err) {\n        console.log(err)\n      } else {\n        console.log(data)\n        opts.callback(data, opts)\n      }\n    })\n  }\n\n  createResource(opts) {\n    const url = `${this.urlOrigin}${API_ENDPOINTS[this.resourceType].postUrl}`;\n    const data = opts.data;\n    const config = opts.config;\n\n    axios({\n      url,\n      data,\n      config,\n      method: 'post',\n      responseType: 'json',\n    }).then(res => {\n      if (res.data.errors) {\n        return opts.onError(res.data)\n      }\n      opts.onSuccess(res.data)\n    }).catch(err => {\n      console.log(err)\n      opts.onFail(err)\n    })\n  }\n\n  updateResource(opts, id) {\n    const url = `${this.urlOrigin}${API_ENDPOINTS[this.resourceType].postUrl}${id}/`;\n    const data = opts.data;\n    const config = opts.config;\n\n    axios({\n      url,\n      data,\n      config,\n      method: 'post',\n      responseType: 'json',\n    }).then(res => {\n      if (res.data.errors) {\n        return opts.onError(res.data)\n      }\n      opts.onSuccess(res.data)\n    }).catch(err => {\n      console.log(err)\n      opts.onFail(err)\n    })\n  }\n}\n"],"mappings":"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"}