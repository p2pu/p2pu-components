{"version":3,"file":"apiHelper.js","names":["API_ENDPOINTS","DEFAULT_ORIGIN","jsonp","axios","ApiHelper","resourceType","origin","urlOrigin","baseUrl","validParams","searchParams","params","encodedParams","map","key","value","Array","isArray","length","encodeURIComponent","queryString","filter","a","join","console","log","opts","url","generateUrl","err","data","callback","postUrl","config","method","responseType","then","res","errors","onError","onSuccess","onFail","id"],"sources":["../../src/utils/apiHelper.js"],"sourcesContent":["import { API_ENDPOINTS, DEFAULT_ORIGIN } from './constants';\nimport jsonp from 'jsonp';\nimport axios from 'axios';\n\nexport default class ApiHelper {\n  constructor(resourceType, origin=DEFAULT_ORIGIN) {\n    this.resourceType = resourceType;\n    this.urlOrigin = origin;\n    this.baseUrl = `${origin}${API_ENDPOINTS[resourceType].baseUrl}`;\n    this.validParams = API_ENDPOINTS[resourceType].searchParams;\n  }\n\n  generateUrl(params) {\n    const baseUrl = this.baseUrl;\n    const encodedParams = this.validParams.map((key) => {\n      const value = params[key];\n      if (!!value && !(Array.isArray(value) && value.length == 0)) { // don't encode falsy values or empty arrays\n        return `${key}=${encodeURIComponent(value)}`\n      }\n    })\n    const queryString = encodedParams.filter(a => a).join('&');\n\n    console.log('url', `${baseUrl}${queryString}`)\n    return `${baseUrl}${queryString}`\n  }\n\n  fetchResource(opts) {\n    const url = this.generateUrl(opts.params)\n\n    jsonp(url, null, (err, data) => {\n      if (err) {\n        console.log(err)\n      } else {\n        console.log(data)\n        opts.callback(data, opts)\n      }\n    })\n  }\n\n  createResource(opts) {\n    const url = `${this.urlOrigin}${API_ENDPOINTS[this.resourceType].postUrl}`;\n    const data = opts.data;\n    const config = opts.config;\n\n    axios({\n      url,\n      data,\n      config,\n      method: 'post',\n      responseType: 'json',\n    }).then(res => {\n      if (res.data.errors) {\n        return opts.onError(res.data)\n      }\n      opts.onSuccess(res.data)\n    }).catch(err => {\n      console.log(err)\n      opts.onFail(err)\n    })\n  }\n\n  updateResource(opts, id) {\n    const url = `${this.urlOrigin}${API_ENDPOINTS[this.resourceType].postUrl}${id}/`;\n    const data = opts.data;\n    const config = opts.config;\n\n    axios({\n      url,\n      data,\n      config,\n      method: 'post',\n      responseType: 'json',\n    }).then(res => {\n      if (res.data.errors) {\n        return opts.onError(res.data)\n      }\n      opts.onSuccess(res.data)\n    }).catch(err => {\n      console.log(err)\n      opts.onFail(err)\n    })\n  }\n}\n"],"mappings":"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"}