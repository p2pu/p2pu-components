{"version":3,"file":"LocationFilter.js","names":["React","Component","axios","t","CitySelect","Select","OnlineFilters","EVERYTHING","ONLINE","IN_PERSON","LocationFilter","props","e","useGeolocation","target","checked","setState","gettingLocation","useLocation","error","updateQueryParams","latitude","longitude","success","position","coords","city","detectDistanceUnit","options","timeout","maximumAge","navigator","geolocation","getCurrentPosition","lat","lon","countriesUsingMiles","url","get","then","res","useMiles","indexOf","countryCode","distance","label","state","range","filter","online","unit","value","generateDistanceValue","Math","round","Boolean","prevProps","distanceValue","handleCitySelect","origin","getLocation","map","d","handleRangeChange","undefined","handleOnlineFilter"],"sources":["../../src/LearningCircles/LocationFilter.jsx"],"sourcesContent":["import React, { Component } from 'react'\nimport axios from 'axios';\nimport {t} from 'ttag';\nimport {CitySelect} from './CitySelect'\nimport Select from '../InputFields/Select';\n\nconst OnlineFilters = {\n\tEVERYTHING: null,\n\tONLINE: \"true\",\n\tIN_PERSON: \"false\",\n}\n\nexport default class LocationFilter extends Component {\n  constructor(props) {\n    super(props)\n    this.state = { \n      useLocation: (Boolean(props.latitude) && Boolean(props.longitude)),\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props !== prevProps) {\n      if (this.props.latitude === null && this.props.longitude === null) {\n        this.setState({ useLocation: false })\n      }\n    }\n  }\n\n  getLocation = (e) => {\n    const useGeolocation = e.target.checked;\n    \n\n    this.setState({ gettingLocation: useGeolocation, useLocation: useGeolocation, error: null });\n\n    if (useGeolocation === false) {\n      this.props.updateQueryParams({ latitude: null, longitude: null, useLocation: useGeolocation });\n      return;\n    }\n\n    const success = (position) => {\n      this.props.updateQueryParams({ latitude: position.coords.latitude, longitude: position.coords.longitude, city: null })\n      this.detectDistanceUnit(position.coords.latitude, position.coords.longitude);\n      this.setState({ gettingLocation: false });\n    }\n\n    const error = () => {\n      this.setState({ error: t`Unable to detect location.`, gettingLocation: false, useLocation: false})\n      this.props.updateQueryParams({ latitude: null, longitude: null, useLocation: useGeolocation });\n    }\n\n    const options = {\n      timeout: 10000,\n      maximumAge: 60000\n    }\n\n    if ('geolocation' in navigator) {\n      navigator.geolocation.getCurrentPosition(success, error, options)\n    } else {\n      this.setState({ error: t`Geolocation is not supported by this browser.`, gettingLocation: false, useLocation: false})\n      this.props.updateQueryParams({ latitude: null, longitude: null, useLocation: useGeolocation });\n    }\n  }\n\n  detectDistanceUnit = (lat, lon) => {\n    const countriesUsingMiles = ['US', 'GB', 'LR', 'MM'];\n    const url = `http://api.geonames.org/countryCodeJSON?lat=${lat}&lng=${lon}&username=p2pu`;\n\n    axios.get(url)\n      .then(res => {\n        const useMiles = countriesUsingMiles.indexOf(res.countryCode) >= 0;\n        // update distance so that options in dropdown remains 5, 10, 25, ...\n        // regardless of kilometer of miles\n        let distance = this.props.distance;\n        if (useMiles != this.props.useMiles){\n          distance = useMiles?distance*1.6:distance*0.625;\n        }\n        this.props.updateQueryParams({ useMiles, distance })\n      })\n  }\n\n  generateLocationLabel = () => {\n    let label = t`Use my current location`;\n\n    if (this.state.error) {\n      label = this.state.error;\n    } else if (this.state.gettingLocation) {\n      label = t`Detecting your location...`;\n    } else if (!this.state.gettingLocation && this.props.latitude && this.props.longitude) {\n      label = t`Using your current location`;\n    }\n\n    return label;\n  }\n\n  handleCitySelect = (city) => {\n    // want to get lat and lon for city\n    this.props.updateQueryParams({ ...city, latitude: null, longitude: null });\n    this.setState({ useLocation: false, error: null });\n  }\n\n  handleRangeChange = ({range}) => {\n    let distance = range;\n    if (this.props.useMiles) {\n      return this.props.updateQueryParams({ distance: distance * 1.6 })\n    }\n    this.props.updateQueryParams({ distance });\n  }\n\n  handleOnlineFilter = (filter) => {\n    this.props.updateQueryParams({ online: filter })\n  }\n\n  generateDistanceSliderLabel = () => {\n    const unit = this.props.useMiles ? t`miles` : t`km`;\n    const value = this.generateDistanceValue();\n    return t`Within ${value} ${unit}`;\n  }\n\n  generateDistanceValue = () => {\n    const value = this.props.useMiles ? this.props.distance * 0.625 : this.props.distance;\n    return Math.round(value / 5) * 5;\n  }\n\n  render() {\n    const distanceValue = this.generateDistanceValue();\n\n    return (\n      <form className=\"filter\">\n        <label htmlFor=\"search-input\" className=\"form-label\">Location</label>\n        <div className=\"search-input my-2 my-md-0\">\n          <CitySelect\n            name='city'\n            value={this.props.city}\n            isClearable={true}\n            handleChange={this.handleCitySelect}\n            placeholder={t`Start typing a city name`}\n            origin={this.props.origin}\n          />\n        </div>\n\n        <div className=\"d-flex flex-column align-items-center p-3\">\n          <div className=\"divider-line\"></div>\n          <div className=\"divider-text\">or</div>\n        </div>\n\n        <div className=\"input-group-md has-validation\">\n          <input \n            type=\"checkbox\" \n            checked={this.state.useLocation || false}\n            onChange={this.getLocation}\n            className={this.state.error?'is-invalid':''}\n          />\n          <span>Within</span>\n          <Select\n            className=\"flex-grow-1\" \n            name=\"range\"\n            options={[5, 10, 25, 50, 100].map(d => ({label: `${d}`, value: d}))}\n            value={distanceValue}\n            handleChange={this.handleRangeChange}\n          />\n          { this.props.useMiles && <span>miles of my current location</span> }\n          { !this.props.useMiles && <span>kilometers of my current location</span> }\n          <span className=\"material-icons\">place </span>\n          { this.state.error &&\n            <div className=\"invalid-feedback\">{ this.state.error }</div>\n          }\n        </div>\n        <div className=\"my-3\">\n          <label htmlFor=\"search-input\" className=\"form-label\">In Person or Online</label>\n          <span>\n          <div className=\"form-check\">\n            <input \n              className=\"form-check-input\" \n              type=\"radio\" \n              name=\"online-filter\" \n              id=\"everything\" \n              checked={\n                this.props.online === OnlineFilters.EVERYTHING || \n                this.props.online === undefined\n              } \n              onChange={() => this.handleOnlineFilter(OnlineFilters.EVERYTHING)}\n            />\n            <label className=\"form-check-label\" htmlFor=\"everything\">\n              Everything\n            </label>\n          </div>\n          <div className=\"form-check\">\n            <input \n              className=\"form-check-input\" \n              type=\"radio\" \n              name=\"online-filter\" \n              id=\"online\"\n              checked={this.props.online === OnlineFilters.ONLINE} \n              onChange={() => this.handleOnlineFilter(OnlineFilters.ONLINE)} \n            />\n            <label className=\"form-check-label\" htmlFor=\"online\">\n              Online\n            </label>\n          </div>\n          <div className=\"form-check\">\n            <input \n              className=\"form-check-input\" \n              type=\"radio\" \n              name=\"online-filter\" \n              id=\"in-person\"\n              checked={this.props.online === OnlineFilters.IN_PERSON}\n              onChange={() => this.handleOnlineFilter(OnlineFilters.IN_PERSON)}\n            />\n            <label className=\"form-check-label\" htmlFor=\"in-person\">\n              In person\n            </label>\n          </div>\n          </span>\n        </div>\n      </form>\n    );\n  }\n}\n"],"mappings":"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"}