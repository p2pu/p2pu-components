{"version":3,"sources":["../../src/LearningCircles/LocationFilter.jsx"],"names":["React","Component","axios","t","CitySelect","Select","OnlineFilters","EVERYTHING","ONLINE","IN_PERSON","LocationFilter","props","e","useGeolocation","target","checked","setState","gettingLocation","useLocation","error","updateQueryParams","latitude","longitude","success","position","coords","city","detectDistanceUnit","options","timeout","maximumAge","navigator","geolocation","getCurrentPosition","lat","lon","countriesUsingMiles","url","get","then","res","useMiles","indexOf","countryCode","distance","label","state","range","filter","online","unit","value","generateDistanceValue","Math","round","Boolean","prevProps","distanceValue","handleCitySelect","origin","getLocation","map","d","handleRangeChange","undefined","handleOnlineFilter"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport axios from 'axios';\nimport {t} from 'ttag';\nimport {CitySelect} from './CitySelect'\nimport Select from '../InputFields/Select';\n\nconst OnlineFilters = {\n\tEVERYTHING: null,\n\tONLINE: \"true\",\n\tIN_PERSON: \"false\",\n}\n\nexport default class LocationFilter extends Component {\n  constructor(props) {\n    super(props)\n    this.state = { \n      useLocation: (Boolean(props.latitude) && Boolean(props.longitude)),\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props !== prevProps) {\n      if (this.props.latitude === null && this.props.longitude === null) {\n        this.setState({ useLocation: false })\n      }\n    }\n  }\n\n  getLocation = (e) => {\n    const useGeolocation = e.target.checked;\n    \n\n    this.setState({ gettingLocation: useGeolocation, useLocation: useGeolocation, error: null });\n\n    if (useGeolocation === false) {\n      this.props.updateQueryParams({ latitude: null, longitude: null, useLocation: useGeolocation });\n      return;\n    }\n\n    const success = (position) => {\n      this.props.updateQueryParams({ latitude: position.coords.latitude, longitude: position.coords.longitude, city: null })\n      this.detectDistanceUnit(position.coords.latitude, position.coords.longitude);\n      this.setState({ gettingLocation: false });\n    }\n\n    const error = () => {\n      this.setState({ error: t`Unable to detect location.`, gettingLocation: false, useLocation: false})\n      this.props.updateQueryParams({ latitude: null, longitude: null, useLocation: useGeolocation });\n    }\n\n    const options = {\n      timeout: 10000,\n      maximumAge: 60000\n    }\n\n    if ('geolocation' in navigator) {\n      navigator.geolocation.getCurrentPosition(success, error, options)\n    } else {\n      this.setState({ error: t`Geolocation is not supported by this browser.`, gettingLocation: false, useLocation: false})\n      this.props.updateQueryParams({ latitude: null, longitude: null, useLocation: useGeolocation });\n    }\n  }\n\n  detectDistanceUnit = (lat, lon) => {\n    const countriesUsingMiles = ['US', 'GB', 'LR', 'MM'];\n    const url = `http://api.geonames.org/countryCodeJSON?lat=${lat}&lng=${lon}&username=p2pu`;\n\n    axios.get(url)\n      .then(res => {\n        const useMiles = countriesUsingMiles.indexOf(res.countryCode) >= 0;\n        // update distance so that options in dropdown remains 5, 10, 25, ...\n        // regardless of kilometer of miles\n        let distance = this.props.distance;\n        if (useMiles != this.props.useMiles){\n          distance = useMiles?distance*1.6:distance*0.625;\n        }\n        this.props.updateQueryParams({ useMiles, distance })\n      })\n  }\n\n  generateLocationLabel = () => {\n    let label = t`Use my current location`;\n\n    if (this.state.error) {\n      label = this.state.error;\n    } else if (this.state.gettingLocation) {\n      label = t`Detecting your location...`;\n    } else if (!this.state.gettingLocation && this.props.latitude && this.props.longitude) {\n      label = t`Using your current location`;\n    }\n\n    return label;\n  }\n\n  handleCitySelect = (city) => {\n    // want to get lat and lon for city\n    this.props.updateQueryParams({ ...city, latitude: null, longitude: null });\n    this.setState({ useLocation: false, error: null });\n  }\n\n  handleRangeChange = ({range}) => {\n    let distance = range;\n    if (this.props.useMiles) {\n      return this.props.updateQueryParams({ distance: distance * 1.6 })\n    }\n    this.props.updateQueryParams({ distance });\n  }\n\n  handleOnlineFilter = (filter) => {\n    this.props.updateQueryParams({ online: filter })\n  }\n\n  generateDistanceSliderLabel = () => {\n    const unit = this.props.useMiles ? t`miles` : t`km`;\n    const value = this.generateDistanceValue();\n    return t`Within ${value} ${unit}`;\n  }\n\n  generateDistanceValue = () => {\n    const value = this.props.useMiles ? this.props.distance * 0.625 : this.props.distance;\n    return Math.round(value / 5) * 5;\n  }\n\n  render() {\n    const distanceValue = this.generateDistanceValue();\n\n    return (\n      <form className=\"filter\">\n        <label htmlFor=\"search-input\" className=\"form-label\">Location</label>\n        <div className=\"search-input my-2 my-md-0\">\n          <CitySelect\n            name='city'\n            value={this.props.city}\n            isClearable={true}\n            handleChange={this.handleCitySelect}\n            placeholder={t`Start typing a city name`}\n            origin={this.props.origin}\n          />\n        </div>\n\n        <div className=\"d-flex flex-column align-items-center p-3\">\n          <div className=\"divider-line\"></div>\n          <div className=\"divider-text\">or</div>\n        </div>\n\n        <div className=\"input-group-md has-validation\">\n          <input \n            type=\"checkbox\" \n            checked={this.state.useLocation || false}\n            onChange={this.getLocation}\n            className={this.state.error?'is-invalid':''}\n          />\n          <span>Within</span>\n          <Select\n            className=\"flex-grow-1\" \n            name=\"range\"\n            options={[5, 10, 25, 50, 100].map(d => ({label: `${d}`, value: d}))}\n            value={distanceValue}\n            handleChange={this.handleRangeChange}\n          />\n          { this.props.useMiles && <span>miles of my current location</span> }\n          { !this.props.useMiles && <span>kilometers of my current location</span> }\n          <span className=\"material-icons\">place </span>\n          { this.state.error &&\n            <div className=\"invalid-feedback\">{ this.state.error }</div>\n          }\n        </div>\n        <div className=\"my-3\">\n          <label htmlFor=\"search-input\" className=\"form-label\">In Person or Online</label>\n          <span>\n          <div className=\"form-check\">\n            <input \n              className=\"form-check-input\" \n              type=\"radio\" \n              name=\"online-filter\" \n              id=\"everything\" \n              checked={\n                this.props.online === OnlineFilters.EVERYTHING || \n                this.props.online === undefined\n              } \n              onChange={() => this.handleOnlineFilter(OnlineFilters.EVERYTHING)}\n            />\n            <label className=\"form-check-label\" htmlFor=\"everything\">\n              Everything\n            </label>\n          </div>\n          <div className=\"form-check\">\n            <input \n              className=\"form-check-input\" \n              type=\"radio\" \n              name=\"online-filter\" \n              id=\"online\"\n              checked={this.props.online === OnlineFilters.ONLINE} \n              onChange={() => this.handleOnlineFilter(OnlineFilters.ONLINE)} \n            />\n            <label className=\"form-check-label\" htmlFor=\"online\">\n              Online\n            </label>\n          </div>\n          <div className=\"form-check\">\n            <input \n              className=\"form-check-input\" \n              type=\"radio\" \n              name=\"online-filter\" \n              id=\"in-person\"\n              checked={this.props.online === OnlineFilters.IN_PERSON}\n              onChange={() => this.handleOnlineFilter(OnlineFilters.IN_PERSON)}\n            />\n            <label className=\"form-check-label\" htmlFor=\"in-person\">\n              In person\n            </label>\n          </div>\n          </span>\n        </div>\n      </form>\n    );\n  }\n}\n"],"file":"LocationFilter.js"}