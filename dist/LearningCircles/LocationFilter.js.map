{"version":3,"sources":["../../src/LearningCircles/LocationFilter.jsx"],"names":["React","Component","axios","t","CheckboxWithLabel","RangeSliderWithLabel","CitySelectInput","Select","LocationFilter","props","e","useGeolocation","target","checked","setState","gettingLocation","useLocation","updateQueryParams","latitude","longitude","success","position","coords","city","detectDistanceUnit","error","options","timeout","maximumAge","navigator","geolocation","getCurrentPosition","lat","lon","countriesUsingMiles","url","get","then","res","useMiles","indexOf","countryCode","distance","label","state","range","unit","value","generateDistanceValue","Math","round","Boolean","prevProps","distanceSliderLabel","generateDistanceSliderLabel","distanceValue","handleCitySelect","getLocation","map","d","handleRangeChange"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAAQC,CAAR,QAAgB,MAAhB;AACA,OAAOC,iBAAP,MAA8B,kCAA9B;AACA,OAAOC,oBAAP,MAAiC,qCAAjC;AACA,SAAQC,eAAR,QAA8B,2BAA9B;AACA,OAAOC,MAAP,MAAmB,uBAAnB;;IAEqBC,c;;;;;AACnB,0BAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,8BAAMA,KAAN;;AADiB,kEAaL,UAACC,CAAD,EAAO;AACnB,UAAMC,cAAc,GAAGD,CAAC,CAACE,MAAF,CAASC,OAAhC;;AAEA,YAAKC,QAAL,CAAc;AAAEC,QAAAA,eAAe,EAAEJ,cAAnB;AAAmCK,QAAAA,WAAW,EAAEL;AAAhD,OAAd;;AAEA,UAAIA,cAAc,KAAK,KAAvB,EAA8B;AAC5B,cAAKF,KAAL,CAAWQ,iBAAX,CAA6B;AAAEC,UAAAA,QAAQ,EAAE,IAAZ;AAAkBC,UAAAA,SAAS,EAAE,IAA7B;AAAmCH,UAAAA,WAAW,EAAEL;AAAhD,SAA7B;;AACA;AACD;;AAED,UAAMS,OAAO,GAAG,SAAVA,OAAU,CAACC,QAAD,EAAc;AAC5B,cAAKZ,KAAL,CAAWQ,iBAAX,CAA6B;AAAEC,UAAAA,QAAQ,EAAEG,QAAQ,CAACC,MAAT,CAAgBJ,QAA5B;AAAsCC,UAAAA,SAAS,EAAEE,QAAQ,CAACC,MAAT,CAAgBH,SAAjE;AAA4EI,UAAAA,IAAI,EAAE;AAAlF,SAA7B;;AACA,cAAKC,kBAAL,CAAwBH,QAAQ,CAACC,MAAT,CAAgBJ,QAAxC,EAAkDG,QAAQ,CAACC,MAAT,CAAgBH,SAAlE;;AACA,cAAKL,QAAL,CAAc;AAAEC,UAAAA,eAAe,EAAE;AAAnB,SAAd;AACD,OAJD;;AAMA,UAAMU,KAAK,GAAG,SAARA,KAAQ,GAAM;AAClB,cAAKX,QAAL,CAAc;AAAEW,UAAAA,KAAK,EAAEtB,CAAF;AAAP,SAAd;AACD,OAFD;;AAIA,UAAMuB,OAAO,GAAG;AACdC,QAAAA,OAAO,EAAE,KADK;AAEdC,QAAAA,UAAU,EAAE;AAFE,OAAhB;;AAKA,UAAI,iBAAiBC,SAArB,EAAgC;AAC9BA,QAAAA,SAAS,CAACC,WAAV,CAAsBC,kBAAtB,CAAyCX,OAAzC,EAAkDK,KAAlD,EAAyDC,OAAzD;AACD,OAFD,MAEO;AACL,cAAKZ,QAAL,CAAc;AAAEW,UAAAA,KAAK,EAAEtB,CAAF;AAAP,SAAd;AACD;AACF,KA3CkB;;AAAA,yEA6CE,UAAC6B,GAAD,EAAMC,GAAN,EAAc;AACjC,UAAMC,mBAAmB,GAAG,CAAC,IAAD,EAAO,IAAP,EAAa,IAAb,EAAmB,IAAnB,CAA5B;AACA,UAAMC,GAAG,yDAAkDH,GAAlD,kBAA6DC,GAA7D,mBAAT;AAEA/B,MAAAA,KAAK,CAACkC,GAAN,CAAUD,GAAV,EACGE,IADH,CACQ,UAAAC,GAAG,EAAI;AACX,YAAMC,QAAQ,GAAGL,mBAAmB,CAACM,OAApB,CAA4BF,GAAG,CAACG,WAAhC,KAAgD,CAAjE,CADW,CAEX;AACA;;AACA,YAAIC,QAAQ,GAAG,MAAKjC,KAAL,CAAWiC,QAA1B;;AACA,YAAIH,QAAQ,IAAI,MAAK9B,KAAL,CAAW8B,QAA3B,EAAoC;AAClCG,UAAAA,QAAQ,GAAGH,QAAQ,GAACG,QAAQ,GAAC,GAAV,GAAcA,QAAQ,GAAC,KAA1C;AACD;;AACD,cAAKjC,KAAL,CAAWQ,iBAAX,CAA6B;AAAEsB,UAAAA,QAAQ,EAARA,QAAF;AAAYG,UAAAA,QAAQ,EAARA;AAAZ,SAA7B;AACD,OAVH;AAWD,KA5DkB;;AAAA,4EA8DK,YAAM;AAC5B,UAAIC,KAAK,GAAGxC,CAAH,8FAAT;;AAEA,UAAI,MAAKyC,KAAL,CAAWnB,KAAf,EAAsB;AACpBkB,QAAAA,KAAK,GAAG,MAAKC,KAAL,CAAWnB,KAAnB;AACD,OAFD,MAEO,IAAI,MAAKmB,KAAL,CAAW7B,eAAf,EAAgC;AACrC4B,QAAAA,KAAK,GAAGxC,CAAH,iGAAL;AACD,OAFM,MAEA,IAAI,CAAC,MAAKyC,KAAL,CAAW7B,eAAZ,IAA+B,MAAKN,KAAL,CAAWS,QAA1C,IAAsD,MAAKT,KAAL,CAAWU,SAArE,EAAgF;AACrFwB,QAAAA,KAAK,GAAGxC,CAAH,kGAAL;AACD;;AAED,aAAOwC,KAAP;AACD,KA1EkB;;AAAA,uEA4EA,UAACpB,IAAD,EAAU;AAC3B;AACA,YAAKd,KAAL,CAAWQ,iBAAX,iCAAkCM,IAAlC;AAAwCL,QAAAA,QAAQ,EAAE,IAAlD;AAAwDC,QAAAA,SAAS,EAAE;AAAnE;;AACA,YAAKL,QAAL,CAAc;AAAEE,QAAAA,WAAW,EAAE;AAAf,OAAd;AACD,KAhFkB;;AAAA,wEAkFC,gBAAa;AAAA,UAAX6B,KAAW,QAAXA,KAAW;AAC/B,UAAIH,QAAQ,GAAGG,KAAf;;AACA,UAAI,MAAKpC,KAAL,CAAW8B,QAAf,EAAyB;AACvB,eAAO,MAAK9B,KAAL,CAAWQ,iBAAX,CAA6B;AAAEyB,UAAAA,QAAQ,EAAEA,QAAQ,GAAG;AAAvB,SAA7B,CAAP;AACD;;AACD,YAAKjC,KAAL,CAAWQ,iBAAX,CAA6B;AAAEyB,QAAAA,QAAQ,EAARA;AAAF,OAA7B;AACD,KAxFkB;;AAAA,kFA0FW,YAAM;AAClC,UAAMI,IAAI,GAAG,MAAKrC,KAAL,CAAW8B,QAAX,GAAsBpC,CAAtB,+EAAiCA,CAAjC,yEAAb;;AACA,UAAM4C,KAAK,GAAG,MAAKC,qBAAL,EAAd;;AACA,aAAO7C,CAAP,wFAAkB4C,KAAlB,EAA2BD,IAA3B;AACD,KA9FkB;;AAAA,4EAgGK,YAAM;AAC5B,UAAMC,KAAK,GAAG,MAAKtC,KAAL,CAAW8B,QAAX,GAAsB,MAAK9B,KAAL,CAAWiC,QAAX,GAAsB,KAA5C,GAAoD,MAAKjC,KAAL,CAAWiC,QAA7E;AACA,aAAOO,IAAI,CAACC,KAAL,CAAWH,KAAK,GAAG,CAAnB,IAAwB,CAA/B;AACD,KAnGkB;;AAEjB,UAAKH,KAAL,GAAa;AAAE5B,MAAAA,WAAW,EAAGmC,OAAO,CAAC1C,KAAK,CAACS,QAAP,CAAP,IAA2BiC,OAAO,CAAC1C,KAAK,CAACU,SAAP;AAAlD,KAAb;AAFiB;AAGlB;;;;WAED,4BAAmBiC,SAAnB,EAA8B;AAC5B,UAAI,KAAK3C,KAAL,KAAe2C,SAAnB,EAA8B;AAC5B,YAAI,KAAK3C,KAAL,CAAWS,QAAX,KAAwB,IAAxB,IAAgC,KAAKT,KAAL,CAAWU,SAAX,KAAyB,IAA7D,EAAmE;AACjE,eAAKL,QAAL,CAAc;AAAEE,YAAAA,WAAW,EAAE;AAAf,WAAd;AACD;AACF;AACF;;;WA0FD,kBAAS;AACP,UAAMqC,mBAAmB,GAAG,KAAKC,2BAAL,EAA5B;AACA,UAAMC,aAAa,GAAG,KAAKP,qBAAL,EAAtB;AAEA,0BACE;AAAM,QAAA,SAAS,EAAC;AAAhB,sBACE;AAAO,QAAA,OAAO,EAAC,cAAf;AAA8B,QAAA,SAAS,EAAC;AAAxC,oBADF,eAEE;AAAK,QAAA,SAAS,EAAC;AAAf,sBACE,oBAAC,eAAD;AACE,QAAA,IAAI,EAAC,MADP;AAEE,QAAA,KAAK,EAAE,KAAKvC,KAAL,CAAWc,IAFpB;AAGE,QAAA,WAAW,EAAE,IAHf;AAIE,QAAA,YAAY,EAAE,KAAKiC,gBAJrB;AAKE,QAAA,WAAW,EAAErD,CAAF;AALb,QADF,CAFF,eAYE;AAAK,QAAA,SAAS,EAAC;AAAf,sBACE;AAAK,QAAA,SAAS,EAAC;AAAf,QADF,eAEE;AAAK,QAAA,SAAS,EAAC;AAAf,cAFF,CAZF,eAiBE;AAAK,QAAA,SAAS,EAAC;AAAf,SACI,sBAAS,oBAAC,iBAAD;AACP,QAAA,OAAO,EAAC,WADD;AAEP,QAAA,IAAI,EAAC,aAFE;AAGP,QAAA,KAAK,EAAC,EAHC;AAIP,QAAA,KAAK,EAAE,KAAKyC,KAAL,CAAW5B,WAAX,IAA0B,KAJ1B;AAKP,QAAA,YAAY,EAAE,KAAKyC;AALZ,QADb,eASE;AACE,QAAA,IAAI,EAAC,UADP;AAEE,QAAA,OAAO,EAAE,KAAKb,KAAL,CAAW5B,WAAX,IAA0B,KAFrC;AAGE,QAAA,QAAQ,EAAE,KAAKyC;AAHjB,QATF,eAcE,2CAdF,eAeE,oBAAC,MAAD;AACE,QAAA,SAAS,EAAC,aADZ;AAEE,QAAA,IAAI,EAAC,OAFP;AAGE,QAAA,OAAO,EAAE,CAAC,CAAD,EAAI,EAAJ,EAAQ,EAAR,EAAY,EAAZ,EAAgB,GAAhB,EAAqBC,GAArB,CAAyB,UAAAC,CAAC;AAAA,iBAAK;AAAChB,YAAAA,KAAK,YAAKgB,CAAL,CAAN;AAAgBZ,YAAAA,KAAK,EAAEY;AAAvB,WAAL;AAAA,SAA1B,CAHX;AAIE,QAAA,KAAK,EAAEJ,aAJT;AAKE,QAAA,YAAY,EAAE,KAAKK;AALrB,QAfF,EAsBI,KAAKnD,KAAL,CAAW8B,QAAX,iBAAuB,iEAtB3B,EAuBI,CAAC,KAAK9B,KAAL,CAAW8B,QAAZ,iBAAwB,sEAvB5B,eAwBE;AAAM,QAAA,SAAS,EAAC;AAAhB,kBAxBF,EAyBI,sBACF,+CACE;AAAK,iBAAM;AAAX,sBACE;AAAO,iBAAM,kBAAb;AAAgC,QAAA,IAAI,EAAC,UAArC;AAAgD,QAAA,KAAK,EAAC,EAAtD;AAAyD,QAAA,EAAE,EAAC;AAA5D,QADF,eAEE;AAAO,iBAAM,kBAAb;AAAgC,eAAI;AAApC,kBAFF,CADF,eAKE;AAAK,iBAAM;AAAX,sBACE;AAAO,iBAAM,kBAAb;AAAgC,QAAA,IAAI,EAAC,UAArC;AAAgD,QAAA,KAAK,EAAC,EAAtD;AAAyD,QAAA,EAAE,EAAC;AAA5D,QADF,eAEE;AAAO,iBAAM,kBAAb;AAAgC,eAAI;AAApC,qBAFF,CALF,CA1BF,CAjBF,CADF;AA6DA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACG;;;;EA9MyCtC,S;;SAAvBO,c","sourcesContent":["import React, { Component } from 'react'\nimport axios from 'axios';\nimport {t} from 'ttag';\nimport CheckboxWithLabel from '../InputFields/CheckboxWithLabel'\nimport RangeSliderWithLabel from '../InputFields/RangeSliderWithLabel'\nimport {CitySelectInput} from '../InputFields/CitySelect'\nimport Select from '../InputFields/Select';\n\nexport default class LocationFilter extends Component {\n  constructor(props) {\n    super(props)\n    this.state = { useLocation: (Boolean(props.latitude) && Boolean(props.longitude)) }\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props !== prevProps) {\n      if (this.props.latitude === null && this.props.longitude === null) {\n        this.setState({ useLocation: false })\n      }\n    }\n  }\n\n  getLocation = (e) => {\n    const useGeolocation = e.target.checked;\n\n    this.setState({ gettingLocation: useGeolocation, useLocation: useGeolocation });\n\n    if (useGeolocation === false) {\n      this.props.updateQueryParams({ latitude: null, longitude: null, useLocation: useGeolocation });\n      return;\n    }\n\n    const success = (position) => {\n      this.props.updateQueryParams({ latitude: position.coords.latitude, longitude: position.coords.longitude, city: null })\n      this.detectDistanceUnit(position.coords.latitude, position.coords.longitude);\n      this.setState({ gettingLocation: false });\n    }\n\n    const error = () => {\n      this.setState({ error: t`Unable to detect location.` })\n    }\n\n    const options = {\n      timeout: 10000,\n      maximumAge: 60000\n    }\n\n    if ('geolocation' in navigator) {\n      navigator.geolocation.getCurrentPosition(success, error, options)\n    } else {\n      this.setState({ error: t`Geolocation is not supported by this browser.`})\n    }\n  }\n\n  detectDistanceUnit = (lat, lon) => {\n    const countriesUsingMiles = ['US', 'GB', 'LR', 'MM'];\n    const url = `http://api.geonames.org/countryCodeJSON?lat=${lat}&lng=${lon}&username=p2pu`;\n\n    axios.get(url)\n      .then(res => {\n        const useMiles = countriesUsingMiles.indexOf(res.countryCode) >= 0;\n        // update distance so that options in dropdown remains 5, 10, 25, ...\n        // regardless of kilometer of miles\n        let distance = this.props.distance;\n        if (useMiles != this.props.useMiles){\n          distance = useMiles?distance*1.6:distance*0.625;\n        }\n        this.props.updateQueryParams({ useMiles, distance })\n      })\n  }\n\n  generateLocationLabel = () => {\n    let label = t`Use my current location`;\n\n    if (this.state.error) {\n      label = this.state.error;\n    } else if (this.state.gettingLocation) {\n      label = t`Detecting your location...`;\n    } else if (!this.state.gettingLocation && this.props.latitude && this.props.longitude) {\n      label = t`Using your current location`;\n    }\n\n    return label;\n  }\n\n  handleCitySelect = (city) => {\n    // want to get lat and lon for city\n    this.props.updateQueryParams({ ...city, latitude: null, longitude: null });\n    this.setState({ useLocation: false });\n  }\n\n  handleRangeChange = ({range}) => {\n    let distance = range;\n    if (this.props.useMiles) {\n      return this.props.updateQueryParams({ distance: distance * 1.6 })\n    }\n    this.props.updateQueryParams({ distance });\n  }\n\n  generateDistanceSliderLabel = () => {\n    const unit = this.props.useMiles ? t`miles` : t`km`;\n    const value = this.generateDistanceValue();\n    return t`Within ${value} ${unit}`;\n  }\n\n  generateDistanceValue = () => {\n    const value = this.props.useMiles ? this.props.distance * 0.625 : this.props.distance;\n    return Math.round(value / 5) * 5;\n  }\n\n  render() {\n    const distanceSliderLabel = this.generateDistanceSliderLabel();\n    const distanceValue = this.generateDistanceValue();\n\n    return (\n      <form className=\"filter\">\n        <label htmlFor=\"search-input\" className=\"form-label\">Location</label>\n        <div className=\"search-input my-2 my-md-0\">\n          <CitySelectInput\n            name='city'\n            value={this.props.city}\n            isClearable={true}\n            handleChange={this.handleCitySelect}\n            placeholder={t`Start typing a city name`}\n          />\n        </div>\n\n        <div className=\"d-flex flex-column align-items-center p-3\">\n          <div className=\"divider-line\"></div>\n          <div className=\"divider-text\">or</div>\n        </div>\n\n        <div className=\"input-group-md\">\n          { false && <CheckboxWithLabel\n              classes='col-sm-12'\n              name='geolocation'\n              label=''\n              value={this.state.useLocation || false}\n              handleChange={this.getLocation}\n            />\n          }\n          <input \n            type=\"checkbox\" \n            checked={this.state.useLocation || false}\n            onChange={this.getLocation}\n          />\n          <span>Within</span>\n          <Select\n            className=\"flex-grow-1\" \n            name=\"range\"\n            options={[5, 10, 25, 50, 100].map(d => ({label: `${d}`, value: d}))}\n            value={distanceValue}\n            handleChange={this.handleRangeChange}\n          />\n          { this.props.useMiles && <span>miles of my current location</span> }\n          { !this.props.useMiles && <span>kilometers of my current location</span> }\n          <span className=\"material-icons\">place </span>\n          { false &&\n          <span>\n            <div class=\"form-check\">\n              <input class=\"form-check-input\" type=\"checkbox\" value=\"\" id=\"online\" />\n              <label class=\"form-check-label\" for=\"online\">online</label>\n            </div>\n            <div class=\"form-check\">\n              <input class=\"form-check-input\" type=\"checkbox\" value=\"\" id=\"in-person\" />\n              <label class=\"form-check-label\" for=\"in-person\">in person</label>\n            </div>\n     \n          </span>\n          }\n        </div>\n      </form>\n\n    )\n\n    /*\n    return(\n      <div>\n        <label for=\"search-input\" class=\"form-label\">Location</label>\n        <CheckboxWithLabel\n          classes='col-sm-12'\n          name='geolocation'\n          label={this.generateLocationLabel()}\n          value={this.state.useLocation || false}\n          handleChange={this.getLocation}\n        />\n        <RangeSliderWithLabel\n          classes='col-sm-12'\n          label={distanceSliderLabel}\n          name='distance'\n          value={distanceValue}\n          handleChange={this.handleRangeChange}\n          min={10}\n          max={150}\n          step={10}\n          disabled={!this.state.useLocation}\n        />\n        <div className='divider col-sm-12'>\n          <div className='divider-line'></div>\n          <div className='divider-text'>{t`or`}</div>\n        </div>\n        <CitySelect\n          label={t`Select a location`}\n          classes='city-select col-sm-12 search-input'\n          name='city'\n          value={this.props.city}\n          handleChange={this.handleCitySelect}\n          placeholder={t`Start typing a city name`}\n          noResultsText={t`No results for this city`}\n          isMulti={false}\n        />\n      </div>\n    );\n    */\n  }\n}\n"],"file":"LocationFilter.js"}